import { Title, Subtitle } from "@beyond/docs/components/html";
import { Code } from "@beyond/docs/code";
import { Link, ELink } from "@beyond/docs/components/html";

<Title>Servidor de desarrollo</Title>

Cuando BeyondJS es ejecutado, levanta un servidor de desarrollo por cada distribución configurada en cada proyecto, pudiendo correrlos de forma simultánea.
Si deseas aprender más sobre la configuración de distribuciones, puedes leerlo en <Link to="/docs/projects/distributions">La Sección de Distribuciones.</Link>

El dev server es un servidor http, cuya función principal es la de interfacear con el engine para procesar a demanda los bundles de los módulos. Recibe la petición, identifica el módulo solicitado y retorna el bundle empaquetado según su configuración.

El dev server es utilizado en desarrollo para trabajar de manera homogénea, a demanda (sólo ir procesando los bundles requeridos) y con HMR en las diferentes distribuciones: (nodejs, deno o el browser).

La siguiente es la estructura de funcionamiento posible del entorno de desarrollo de BeyondJS.

// Img

El engine de BeyondJS cuenta con una cache optimizada que guarda el código empaquetado para brindar una respuesta instantánea y que se inválida si el código fuente del bundle es cambiado, generando de forma automática una nueva compilación del empaquetado.

Veamos el uso del Dev Server según la plataforma de ejecución.

<Subtitle>Web, Android, iOS</Subtitle>

En plataformas web, android e ios el dev server no sólo sirve los bundles, sino que adicionalmente devuelve el index.html cuando la url requerida no encuentra un recurso (bundle o archivo estático).

<Subtitle>Deno</Subtitle>

Deno soporta HTTP ES imports de manera nativa y estable.

BeyondJS genera los import maps para resolver los bundles del proyecto. De esta forma, cuando se requiera un bundle registrado en el proyecto, Deno lo cargará apuntando al dev server.

Puedes trabajar con BeyondJS y Deno para construir una aplicación completa, pero también para crear proyectos librería que contienen módulos que puedes consumir desde cualquier otra aplicación.

BeyondJS soporta el concepto de bundles transversales como el "start". Los bundles start se programan en los módulos y su ejecución ocurre en el inicio de la aplicación.
Si estás construyendo una aplicación completa en DENO, lo habitual sería que cargues el bundle "start" **+ info sobre bundle start y bundles transversales.**.

<Subtitle>NodeJS</Subtitle>

El objetivo de BeyondJS es ofrecer un entorno de desarrollo typescript universal.
A diferencia de Deno, que soporta imports HTTP de manera estable desde sus inicios, NodeJS lo implementa en versiones recientes y aún en fase experimental.

<ELink to="https://nodejs.org/api/esm.html#https-and-http-imports">
    https://nodejs.org/api/esm.html#https-and-http-imports
</ELink>

Para brindar una experiencia homogénea, BeyondJS ofrece un entorno de ejecución (**BEE**: Beyond Execution Environment)
específicamente diseñado para ser usado en desarrollo (no en producción) desde NodeJS, encargado de permitir ejecutar una aplicación consumiendo los bundles desde el servidor HTTP y brindando soporte HMR.
De esta manera, puedes correr una aplicación en NodeJS procesando los bundles a demanda, reduciendo el tiempo requerido para el startup.
De no ser por los BEEs, deberías compilar la aplicación completa para que NodeJS pueda requerir de manera sincrónica por los bundles.

<Subtitle>Dockers containers</Subtitle>

Gracias al diseño de consumo de los bundles por medio de HTTP, ejecutar una aplicación en un docker container es tan sencillo como en tu PC local.
Sólo debes configurar los puertos expuestos por el docker container para que pueda alcanzar las peticiones realizadas al dev server.

<Subtitle>Electron</Subtitle>

Las aplicaciones Electron cuentan con dos entornos de ejecución. El browser para la vista de UI y una instancia de NodeJS que se comunican entre sí.
Con BeyondJS puedes trabajar en el mismo proyecto ambos entornos.

Los módulos que especifiquen plataforma “web” estarán disponibles para la vista, y los que especifiquen plataforma “node” lo estarán para ese entorno. Esto permite estructurar tu aplicación de manera ordenada.
El entorno NodeJS de una aplicación Electron debe correr a través de un BEE para consumir a demanda y con soporte HMR los bundles servidos por el dev server.

<Subtitle>Configuración</Subtitle>

BeyondJS evalúa el directorio en donde está siendo ejecutado para identificar el o los proyectos existentes, lo hace validando si existe un archivo `beyond.json`.

El archivo `beyond.json` puede ser editado manualmente o a través del workspace que está disponible por defecto en <ELink to="https://workspace.beyondjs.com/">https://workspace.beyondjs.com/</ELink>

La estructura del `beyond.json` es la siguiente:

<Code>
    {`
"applications": "projects.json",
  "bundles": {},
  "libraries": []
`}
</Code>

**Propiedades**

-   applications <Link to="/aoc">AOC:</Link> Recibe un arreglo con la lista de proyectos o aplicaciones configuradas para que BeyondJS pueda leerlas y levantarlas. Este archivo, es gestionado por BeyondJS si se hace uso del dashboard.
-   bundles object: Permite configurar la inclusión de bundles creados por el programador.
-   libraries <Link to="/aoc">AOC:</Link> Arreglo de configuración de librerias BeyondJS a utilizar.

<Subtitle>¿Por qué Modular + Universal?</Subtitle>

Deno, NodeJS, Chrome, Edge, webview, están todos basados en la misma tecnología Javascript.
El mismo motor, pero no las mismas técnicas de programación.

El consumo de paquetes en NodeJS se basa en NPM y la carpeta node_modules, Deno directamente consume las dependencias como imports HTTP.
Los browsers modernos también cuentan la capacidad de consumir ES modules, pero si programas para web, a diferencia de cuando programas para NodeJS o Deno, seguramente estarás utilizando algún empaquetador como webpack, parcel, rollup, esbuild, etc.

Los empaquetadores consumen los paquetes publicados en NPM para generar un archivo final .js llamado bundle que incluye las dependencias.

También puedes usar empaquetadores para programar en Deno o NodeJS, algo que se está volviendo popular debido al Isomorfismo.

Actualmente están disponibles los ES modules, algo reciente y que simplifica mucho el escenario. Tanto el browser, como NodeJS, como Deno pueden cargar módulos ES de manera nativa.
